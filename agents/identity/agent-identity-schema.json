{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Identity Schema",
  "description": "Anthropic-compliant agent identity schema with x- prefixed custom extensions for Agent Reality Map compliance",
  "version": "2.0.0",
  "type": "object",
  "required": ["name", "description", "tools"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Agent name (Anthropic official field)",
      "pattern": "^[a-z0-9-]+$",
      "examples": ["backend-dev", "coder", "security-manager"]
    },
    "description": {
      "type": "string",
      "description": "Plain text description of what this agent does (Anthropic official field - NO VERIX notation)"
    },
    "tools": {
      "type": "string",
      "description": "Comma-separated list of allowed tools (Anthropic official field)",
      "examples": ["Read, Write, Edit, Bash, Glob, Grep", "Read, Grep, Glob, WebSearch, Task"]
    },
    "model": {
      "type": "string",
      "enum": ["opus", "sonnet", "haiku"],
      "description": "Model to use for this agent (Anthropic official field)",
      "default": "sonnet"
    },
    "permissionMode": {
      "type": "string",
      "enum": ["default", "restricted"],
      "description": "Permission mode (Anthropic optional official field)",
      "default": "default"
    },
    "skills": {
      "type": "string",
      "description": "Comma-separated list of skills this agent can invoke (Anthropic optional official field)"
    },
    "x-agent_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the agent (UUIDv4) - custom extension"
    },
    "x-role": {
      "type": "string",
      "enum": [
        "admin",
        "developer",
        "reviewer",
        "security",
        "database",
        "frontend",
        "backend",
        "tester",
        "analyst",
        "coordinator"
      ],
      "description": "Primary RBAC role determining permissions and access - custom extension"
    },
    "x-capabilities": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of capabilities this agent possesses - custom extension",
      "examples": [
        ["coding", "api-design", "database"],
        ["security-audit", "vulnerability-scanning"],
        ["ui-design", "react", "accessibility"]
      ]
    },
    "x-rbac": {
      "type": "object",
      "properties": {
        "denied_tools": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Tools explicitly denied (overrides tools field)",
          "default": []
        },
        "path_scopes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "File path patterns this agent can access (glob patterns)",
          "examples": [
            ["src/**", "tests/**"],
            ["backend/**", "api/**"],
            ["**"]
          ]
        },
        "api_access": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "openai",
              "anthropic",
              "github",
              "gitlab",
              "memory-mcp",
              "connascence-analyzer",
              "flow-nexus",
              "ruv-swarm"
            ]
          },
          "description": "External APIs this agent can access",
          "default": []
        },
        "requires_approval": {
          "type": "boolean",
          "description": "Whether high-risk operations require human approval",
          "default": false
        },
        "approval_threshold": {
          "type": "number",
          "description": "Cost threshold (USD) triggering approval requirement",
          "minimum": 0,
          "default": 10.0
        }
      },
      "description": "Additional RBAC settings beyond the official tools field - custom extension"
    },
    "x-budget": {
      "type": "object",
      "description": "Token and cost budget settings - custom extension",
      "properties": {
        "max_tokens_per_session": {
          "type": "integer",
          "description": "Maximum tokens this agent can use per session",
          "minimum": 1000,
          "maximum": 1000000,
          "default": 100000
        },
        "max_cost_per_day": {
          "type": "number",
          "description": "Maximum daily cost in currency units",
          "minimum": 0,
          "default": 10.0
        },
        "currency": {
          "type": "string",
          "enum": ["USD", "EUR", "GBP"],
          "default": "USD"
        },
        "current_usage": {
          "type": "object",
          "description": "Current usage tracking (updated at runtime)",
          "properties": {
            "tokens_used_today": {
              "type": "integer",
              "default": 0
            },
            "cost_spent_today": {
              "type": "number",
              "default": 0.0
            },
            "last_reset_timestamp": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      }
    },
    "x-metadata": {
      "type": "object",
      "description": "Additional metadata for organization and discovery - custom extension",
      "properties": {
        "category": {
          "type": "string",
          "enum": [
            "delivery",
            "foundry",
            "operations",
            "orchestration",
            "platforms",
            "quality",
            "research",
            "security",
            "specialists",
            "tooling"
          ],
          "description": "High-level category grouping"
        },
        "specialist": {
          "type": "boolean",
          "description": "Whether this is a specialist agent (vs generalist)",
          "default": false
        },
        "requires_approval": {
          "type": "boolean",
          "description": "Whether operations require human approval",
          "default": false
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Agent version (semantic versioning)",
          "default": "1.0.0"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of agent creation"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last update"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Searchable tags for agent discovery",
          "default": []
        }
      }
    },
    "x-performance": {
      "type": "object",
      "description": "Performance metrics and quality scores (optional, tracked at runtime)",
      "properties": {
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Success rate (0-1) based on historical performance"
        },
        "average_execution_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Average task execution time in milliseconds"
        },
        "quality_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Quality score based on Connascence analysis"
        },
        "total_tasks_completed": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        }
      }
    }
  },
  "field_mappings": {
    "description": "Migration guide from old format to Anthropic-compliant format",
    "old_to_new": {
      "agent_id": "x-agent_id",
      "role": "x-role",
      "capabilities": "x-capabilities",
      "rbac.allowed_tools": "tools (as comma-separated string)",
      "rbac.denied_tools": "x-rbac.denied_tools",
      "rbac.path_scopes": "x-rbac.path_scopes",
      "rbac.api_access": "x-rbac.api_access",
      "budget": "x-budget",
      "metadata": "x-metadata",
      "metadata.category": "x-metadata.category",
      "performance": "x-performance"
    },
    "required_fields": ["name", "description", "tools"],
    "official_optional": ["model", "permissionMode", "skills"]
  },
  "examples": [
    {
      "name": "backend-dev",
      "description": "Backend development specialist for Python/Node.js APIs, database design, and server-side implementation",
      "tools": "Read, Write, Edit, Bash, Task, Glob, Grep",
      "model": "sonnet",
      "x-agent_id": "550e8400-e29b-41d4-a716-446655440000",
      "x-role": "developer",
      "x-capabilities": ["coding", "api-design", "database", "testing"],
      "x-rbac": {
        "denied_tools": ["KillShell"],
        "path_scopes": ["src/**", "backend/**", "tests/**"],
        "api_access": ["github", "memory-mcp"],
        "requires_approval": false,
        "approval_threshold": 10.0
      },
      "x-budget": {
        "max_tokens_per_session": 150000,
        "max_cost_per_day": 20.0,
        "currency": "USD"
      },
      "x-metadata": {
        "category": "delivery",
        "specialist": true,
        "requires_approval": false,
        "version": "1.0.0",
        "tags": ["backend", "api", "development"]
      }
    }
  ]
}
